<?xml version="1.0" encoding="UTF-8" ?>
<!--
 ~ /*
 ~ (C) Copyright 2016 Ymatou (http://www.ymatou.com/).
 ~ All rights reserved.
 ~ */
 -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ymatou.productsync.domain.sqlrepo.CommandQuery">

<!--设置、取消橱窗商品-->
    <select id="setTopProduct" parameterType="java.lang.String"
            resultMap="com.ymatou.productsync.domain.sqlrepo.ProductResultMap.keyValueMap1">

        SELECT TOP 1
        isTop AS 'istop'
        FROM dbo.Ymt_Products WITH(NOLOCK)
        WHERE sProductId = #{productId,jdbcType=VARCHAR};
    </select>

    <!--获取商品详细信息-->
    <select id="getProductBaseInfo"
            resultMap="com.ymatou.productsync.domain.sqlrepo.ProductResultMap.keyValueMap1">

        SELECT TOP 1
        ActionType AS 'ActionType',
        ProductId AS 'ProductId'
        FROM dbo.ApolloTransactionInfo WITH(NOLOCK)
        WHERE TransactionId = 1;
    </select>

    <!--设置、取消橱窗商品-->
    <select id="setTopProduct3"
            resultMap="com.ymatou.productsync.domain.sqlrepo.ProductResultMap.keyValueMap1">

        SELECT TOP 1
        iActivityId AS 'ActivityId',
        sName AS 'Name'
        FROM dbo.Ymt_Activity WITH(NOLOCK)
        WHERE iActivityId = #{liveId};
    </select>


    <!--关闭直播-直播商品+品牌+商品新品时间-->
    <select id="getLiveProductByActivityId"
            resultMap="com.ymatou.productsync.domain.sqlrepo.ProductResultMap.keyValueMap1">

        SELECT a.sProductId AS ProductId,
			   a.iActivityId AS LiveId,
			   a.iUserId AS SellerId,
			   a.dStartTime AS StartTime,
			   a.iCommentNum AS CommentCount,
			   a.dEndTime AS EndTime,
			   a.dAddTime AS AddTime,
			   a.dReadyPutawayProductSort AS ReadyPutawayProductSort,
			   a.iIsTop AS IsTop,
			   p.isNew AS IsNew,
			   p.dListingTime AS NewStartTime,
			   p.dNewEndTime AS NewEndTime,
			   a.iSellStatus AS SellStatus,
			   p.iBrandId AS BrandId,
			   p.sBrand AS BrandName,
			   b.sBrandEn AS BrandEnName,
			   p.iThirdCategoryId AS ThirdCategoryId
		FROM Ymt_ProductsInLive (NOLOCK) a
		INNER JOIN Ymt_Products (NOLOCK) p ON a.sProductId = p.sProductId
		LEFT JOIN Ymt_ProductBrand (NOLOCK) b ON p.iBrandId = b.iBrandId
		WHERE a.iActivityId =  ${activityId} AND ISNULL(a.iAction,0) >-1;
    </select>
</mapper>